
{% extends "base.html" %}

{% block title %}Ana Sayfa - ChatNell{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <h2 style="background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin: 0; font-size: 2rem;">
            👥 Kullanıcı Listesi
        </h2>
        <div style="color: #666; font-size: 14px;">
            <span id="online-count">0</span> çevrimiçi kullanıcı
        </div>
    </div>
    
    {% if users %}
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px;">
            {% for user in users %}
                <div class="user-card" style="border: 2px solid #eee; border-radius: 15px; padding: 25px; text-align: center; transition: all 0.3s; cursor: pointer; background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,249,250,0.9)); backdrop-filter: blur(10px);" 
                     onmouseover="this.style.borderColor='#667eea'; this.style.transform='translateY(-5px)'; this.style.boxShadow='0 15px 35px rgba(102,126,234,0.2)'" 
                     onmouseout="this.style.borderColor='#eee'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    
                    <div style="margin-bottom: 15px;">
                        <div style="width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; margin: 0 auto 10px;">
                            {{ user[0].upper() }}
                        </div>
                        <div class="status-indicator" data-user="{{ user }}" style="width: 12px; height: 12px; border-radius: 50%; background: #95a5a6; margin: 0 auto; border: 2px solid white; position: relative; top: -20px; left: 20px;"></div>
                    </div>
                    
                    <h3 style="color: #2c3e50; margin-bottom: 15px; font-size: 1.3rem;">{{ user }}</h3>
                    <div class="user-status" data-user="{{ user }}" style="font-size: 12px; color: #666; margin-bottom: 20px; min-height: 20px;">
                        🔄 Durum kontrol ediliyor...
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <a href="{{ url_for('profile', username=user) }}" class="btn btn-secondary" style="font-size: 13px; padding: 8px 16px;">
                            👤 Profil
                        </a>
                        <a href="{{ url_for('chat', recipient=user) }}" class="btn" style="font-size: 13px; padding: 8px 16px;">
                            💬 Mesaj
                        </a>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div style="text-align: center; padding: 60px 20px; background: linear-gradient(135deg, rgba(102,126,234,0.05), rgba(118,75,162,0.05)); border-radius: 15px; border: 2px dashed #ddd;">
            <div style="font-size: 4rem; margin-bottom: 20px;">👻</div>
            <h3 style="color: #2c3e50; margin-bottom: 15px;">Henüz başka kullanıcı yok</h3>
            <p style="color: #666; margin-bottom: 25px;">Arkadaşlarınızı ChatNell'e davet edin ve sohbete başlayın!</p>
            <button onclick="navigator.share({title: 'ChatNell', text: 'ChatNell ile mesajlaşmaya başla!', url: window.location.origin})" class="btn" style="font-size: 14px;">
                📤 Arkadaş Davet Et
            </button>
        </div>
    {% endif %}
</div>

<div class="card" style="background: linear-gradient(135deg, rgba(102,126,234,0.05), rgba(118,75,162,0.05));">
    <h3 style="background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 25px; font-size: 1.5rem; text-align: center;">
        🚀 ChatNell Nasıl Kullanılır?
    </h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
        <div style="display: flex; align-items: start; gap: 15px;">
            <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0;">1</div>
            <div>
                <strong style="color: #2c3e50;">Kullanıcı Seç</strong>
                <p style="color: #666; margin-top: 5px; font-size: 14px;">Yukarıdaki listeden mesaj göndermek istediğiniz kullanıcıyı seçin</p>
            </div>
        </div>
        <div style="display: flex; align-items: start; gap: 15px;">
            <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0;">2</div>
            <div>
                <strong style="color: #2c3e50;">Mesaj Gönder</strong>
                <p style="color: #666; margin-top: 5px; font-size: 14px;">"💬 Mesaj" butonuna tıklayın ve sohbeti başlatın</p>
            </div>
        </div>
        <div style="display: flex; align-items: start; gap: 15px;">
            <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0;">3</div>
            <div>
                <strong style="color: #2c3e50;">Eğlen</strong>
                <p style="color: #666; margin-top: 5px; font-size: 14px;">Emoji'ler, arama ve diğer özelliklerin keyfini çıkarın!</p>
            </div>
        </div>
    </div>
</div>

<script>
function updateAllUserStatuses() {
    const statusIndicators = document.querySelectorAll('.status-indicator');
    const statusTexts = document.querySelectorAll('.user-status');
    let onlineCount = 0;
    
    statusIndicators.forEach((indicator, index) => {
        const username = indicator.getAttribute('data-user');
        const statusText = statusTexts[index];
        
        fetch(`/get_user_status/${username}`)
            .then(response => response.json())
            .then(data => {
                const status = data.status;
                
                // Update indicator color
                if (status === 'online') {
                    indicator.style.background = '#27ae60';
                    statusText.textContent = '🟢 Çevrimiçi';
                    onlineCount++;
                } else if (status === 'away') {
                    indicator.style.background = '#f39c12';
                    statusText.textContent = '🟡 Uzakta';
                } else {
                    indicator.style.background = '#e74c3c';
                    const lastSeen = new Date(data.last_seen);
                    const now = new Date();
                    const diffMinutes = Math.floor((now - lastSeen) / (1000 * 60));
                    
                    if (diffMinutes < 60) {
                        statusText.textContent = `🔴 ${diffMinutes} dakika önce`;
                    } else if (diffMinutes < 1440) {
                        statusText.textContent = `🔴 ${Math.floor(diffMinutes / 60)} saat önce`;
                    } else {
                        statusText.textContent = `🔴 ${Math.floor(diffMinutes / 1440)} gün önce`;
                    }
                }
                
                // Update online count
                document.getElementById('online-count').textContent = onlineCount;
            })
            .catch(error => {
                statusText.textContent = '❓ Bilinmiyor';
            });
    });
}

// Load statuses on page load
updateAllUserStatuses();

// Update statuses every 15 seconds
setInterval(updateAllUserStatuses, 15000);

// Add smooth animations
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.user-card');
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            card.style.transition = 'all 0.5s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });
});
</script>
{% endblock %}
